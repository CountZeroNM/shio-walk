{"version":3,"sources":["shio_walk/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db","_","stored-token","js/localStorage","stored-user","G__23597","shio-walk.db/default-db","cljs.core.assoc","cljs.core.js__GT_clj","js/JSON","p__23598","vec__23599","cljs.core.nth","db","error","p__23602","vec__23603","loading?","p__23606","vec__23607","page","re_frame.core.reg_event_fx","p__23610","p__23611","map__23612","cljs.core/--destructure-map","cljs.core.get","vec__23613","user-data","re-frame.core/reg-fx","p1__23616#","p1__23617#","shio-walk.api/register","re-frame.core/dispatch","or__5002__auto__","p__23618","p__23619","map__23620","vec__23621","response","cljs.core/clj->js","p__23624","p__23625","map__23626","vec__23627","credentials","p1__23630#","p1__23631#","shio-walk.api/login","p__23632","p__23633","map__23634","vec__23635","p__23638","map__23639","p__23640","map__23641","token","p1__23642#","shio-walk.api/get-stats","p__23643","vec__23644","stats","p__23647","map__23648","p1__23649#","shio-walk.api/get-walks","p__23651","vec__23652","walks","active-walk","cljs.core/first","p1__23650#","cljs.core.filter","cljs.core._EQ_","p__23655","map__23656","p1__23657#","shio-walk.api/get-rewards","p__23658","vec__23659","rewards","p__23662","map__23663","p1__23664#","shio-walk.api/get-unlocked-rewards","p__23665","vec__23666","unlocked-rewards","p__23669","map__23670","p1__23671#","shio-walk.api/start-walk","p__23672","p__23673","map__23674","vec__23675","walk","p__23678","p__23679","map__23680","vec__23681","walk-id","data","p__23685","vec__23686","p1__23684#","shio-walk.api/update-walk","p__23689","vec__23690","p__23693","p__23694","map__23695","vec__23696","p__23700","vec__23701","p1__23699#","shio-walk.api/complete-walk","p__23704","p__23705","map__23706","vec__23707","result","cljs.core.update","cljs.core/merge","cljs.core/seq","js/alert","clojure.string.join","cljs.core.map"],"sourcesContent":["(ns shio-walk.events\n  (:require [re-frame.core :as rf]\n            [shio-walk.db :as db]\n            [shio-walk.api :as api]))\n\n;; \u521d\u671f\u5316\n(rf/reg-event-db\n :initialize-db\n (fn [_ _]\n   (let [stored-token (.getItem js/localStorage \"token\")\n         stored-user (.getItem js/localStorage \"user\")]\n     (cond-> db/default-db\n       stored-token (assoc :token stored-token)\n       stored-user (assoc :user (js->clj (.parse js/JSON stored-user) :keywordize-keys true))\n       stored-token (assoc :current-page :dashboard)))))\n\n;; \u30a8\u30e9\u30fc\u51e6\u7406\n(rf/reg-event-db\n :set-error\n (fn [db [_ error]]\n   (assoc db :error error :loading? false)))\n\n(rf/reg-event-db\n :clear-error\n (fn [db _]\n   (assoc db :error nil)))\n\n;; \u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u72b6\u614b\n(rf/reg-event-db\n :set-loading\n (fn [db [_ loading?]]\n   (assoc db :loading? loading?)))\n\n;; \u30da\u30fc\u30b8\u9077\u79fb\n(rf/reg-event-db\n :set-page\n (fn [db [_ page]]\n   (assoc db :current-page page :error nil)))\n\n;; \u8a8d\u8a3c\u95a2\u9023\n(rf/reg-event-fx\n :register\n (fn [{:keys [db]} [_ user-data]]\n   {:db (assoc db :loading? true :error nil)\n    :fx [[:register user-data]]}))\n\n(rf/reg-fx\n :register\n (fn [user-data]\n   (api/register\n    user-data\n    #(rf/dispatch [:register-success %])\n    #(rf/dispatch [:set-error (or (:message %) \"\u767b\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f\")]))))\n\n(rf/reg-event-fx\n :register-success\n (fn [{:keys [db]} [_ response]]\n   (.setItem js/localStorage \"token\" (:token response))\n   (.setItem js/localStorage \"user\" (.stringify js/JSON (clj->js (:user response))))\n   {:db (-> db\n            (assoc :token (:token response)\n                   :user (:user response)\n                   :loading? false\n                   :current-page :dashboard))\n    :fx [[:load-initial-data]]}))\n\n(rf/reg-event-fx\n :login\n (fn [{:keys [db]} [_ credentials]]\n   {:db (assoc db :loading? true :error nil)\n    :fx [[:login credentials]]}))\n\n(rf/reg-fx\n :login\n (fn [credentials]\n   (api/login\n    credentials\n    #(rf/dispatch [:login-success %])\n    #(rf/dispatch [:set-error (or (:message %) \"\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f\")]))))\n\n(rf/reg-event-fx\n :login-success\n (fn [{:keys [db]} [_ response]]\n   (.setItem js/localStorage \"token\" (:token response))\n   (.setItem js/localStorage \"user\" (.stringify js/JSON (clj->js (:user response))))\n   {:db (-> db\n            (assoc :token (:token response)\n                   :user (:user response)\n                   :loading? false\n                   :current-page :dashboard))\n    :fx [[:load-initial-data]]}))\n\n(rf/reg-event-fx\n :logout\n (fn [{:keys [db]} _]\n   (.removeItem js/localStorage \"token\")\n   (.removeItem js/localStorage \"user\")\n   {:db (assoc db/default-db :current-page :login)}))\n\n;; \u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\n(rf/reg-fx\n :load-initial-data\n (fn []\n   (rf/dispatch [:load-stats])\n   (rf/dispatch [:load-walks])\n   (rf/dispatch [:load-rewards])\n   (rf/dispatch [:load-unlocked-rewards])))\n\n(rf/reg-event-fx\n :load-stats\n (fn [{:keys [db]} _]\n   {:fx [[:get-stats (:token db)]]}))\n\n(rf/reg-fx\n :get-stats\n (fn [token]\n   (api/get-stats\n    token\n    #(rf/dispatch [:stats-loaded %])\n    #(rf/dispatch [:set-error \"\u7d71\u8a08\u60c5\u5831\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-db\n :stats-loaded\n (fn [db [_ stats]]\n   (assoc db :stats stats)))\n\n(rf/reg-event-fx\n :load-walks\n (fn [{:keys [db]} _]\n   {:fx [[:get-walks (:token db)]]}))\n\n(rf/reg-fx\n :get-walks\n (fn [token]\n   (api/get-walks\n    token\n    #(rf/dispatch [:walks-loaded %])\n    #(rf/dispatch [:set-error \"\u30a6\u30a9\u30fc\u30af\u5c65\u6b74\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-db\n :walks-loaded\n (fn [db [_ walks]]\n   (let [active-walk (first (filter #(= (:status %) \"active\") walks))]\n     (assoc db \n            :walks walks\n            :current-walk active-walk))))\n\n(rf/reg-event-fx\n :load-rewards\n (fn [{:keys [db]} _]\n   {:fx [[:get-rewards (:token db)]]}))\n\n(rf/reg-fx\n :get-rewards\n (fn [token]\n   (api/get-rewards\n    token\n    #(rf/dispatch [:rewards-loaded %])\n    #(rf/dispatch [:set-error \"\u5831\u916c\u4e00\u89a7\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-db\n :rewards-loaded\n (fn [db [_ rewards]]\n   (assoc db :rewards rewards)))\n\n(rf/reg-event-fx\n :load-unlocked-rewards\n (fn [{:keys [db]} _]\n   {:fx [[:get-unlocked-rewards (:token db)]]}))\n\n(rf/reg-fx\n :get-unlocked-rewards\n (fn [token]\n   (api/get-unlocked-rewards\n    token\n    #(rf/dispatch [:unlocked-rewards-loaded %])\n    #(rf/dispatch [:set-error \"\u7372\u5f97\u6e08\u307f\u5831\u916c\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-db\n :unlocked-rewards-loaded\n (fn [db [_ unlocked-rewards]]\n   (assoc db :unlocked-rewards unlocked-rewards)))\n\n;; \u30a6\u30a9\u30fc\u30af\u64cd\u4f5c\n(rf/reg-event-fx\n :start-walk\n (fn [{:keys [db]} _]\n   {:db (assoc db :loading? true)\n    :fx [[:start-walk-api (:token db)]]}))\n\n(rf/reg-fx\n :start-walk-api\n (fn [token]\n   (api/start-walk\n    token\n    #(rf/dispatch [:walk-started %])\n    #(rf/dispatch [:set-error \"\u30a6\u30a9\u30fc\u30af\u306e\u958b\u59cb\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-fx\n :walk-started\n (fn [{:keys [db]} [_ walk]]\n   {:db (assoc db :current-walk walk :loading? false)\n    :fx [[:load-walks]]}))\n\n(rf/reg-event-fx\n :update-walk\n (fn [{:keys [db]} [_ walk-id data]]\n   {:fx [[:update-walk-api [(:token db) walk-id data]]]}))\n\n(rf/reg-fx\n :update-walk-api\n (fn [[token walk-id data]]\n   (api/update-walk\n    token\n    walk-id\n    data\n    #(rf/dispatch [:walk-updated %])\n    #(rf/dispatch [:set-error \"\u30a6\u30a9\u30fc\u30af\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-db\n :walk-updated\n (fn [db [_ walk]]\n   (assoc db :current-walk walk)))\n\n(rf/reg-event-fx\n :complete-walk\n (fn [{:keys [db]} [_ walk-id]]\n   {:db (assoc db :loading? true)\n    :fx [[:complete-walk-api [(:token db) walk-id]]]}))\n\n(rf/reg-fx\n :complete-walk-api\n (fn [[token walk-id]]\n   (api/complete-walk\n    token\n    walk-id\n    #(rf/dispatch [:walk-completed %])\n    #(rf/dispatch [:set-error \"\u30a6\u30a9\u30fc\u30af\u306e\u5b8c\u4e86\u306b\u5931\u6557\u3057\u307e\u3057\u305f\"]))))\n\n(rf/reg-event-fx\n :walk-completed\n (fn [{:keys [db]} [_ result]]\n   {:db (-> db\n            (assoc :current-walk nil :loading? false)\n            (update :stats merge (:stats result)))\n    :fx [[:load-walks]\n         [:load-unlocked-rewards]\n         (when (seq (:new-rewards result))\n           [:show-rewards (:new-rewards result)])]}))\n\n(rf/reg-fx\n :show-rewards\n (fn [rewards]\n   ;; \u5f8c\u3067\u30e2\u30fc\u30c0\u30eb\u8868\u793a\u3092\u5b9f\u88c5\n   (js/alert (str \"\u65b0\u3057\u3044\u5831\u916c\u3092\u7372\u5f97\u3057\u307e\u3057\u305f\uff01\\n\"\n                  (clojure.string/join \"\\n\" (map :title rewards))))))\n"]}